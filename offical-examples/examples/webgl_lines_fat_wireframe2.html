<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - lines - fat - wireframe</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="main.css">
		<style>
			#earth {
				width: 400px;
				height: 400px;
				position: absolute;
				right: 0;
				top: 0;
				background: green;
				z-index: 10;
				border: 2px solid blue;
			}
		</style>
	</head>

	<body>

		<div id="container"></div>
		<div id="earth"></div>

		<div id="info"><a href="https://threejs.org" target="_blank">three.js</a> - fat lines</div>

		<script src="./sphereline.js"></script>
		<script type="module">




			import * as THREE from '../build/three.module.js';

			import { OrbitControls } from './jsm/controls/OrbitControls.js';
			import { LineMaterial } from './jsm/lines/LineMaterial.js';

			let renderer, scene, controls, mapCamera
			let earthRenderer, earthScene, earthControls, earthCamera
			let earthCube, mapCube
			let matLine, matLineBasic, matLineDasheds

			// viewport
			let insetWidth;
			let insetHeight;

			init();


			function init() {
				initMap()
				initEarth()

				function initMap() {
					// 渲染器
					renderer = new THREE.WebGLRenderer( { antialias: true } );
					renderer.setPixelRatio( window.devicePixelRatio );
					renderer.setSize( window.innerWidth, window.innerHeight );
					document.body.appendChild( renderer.domElement );

					// 场景
					scene = new THREE.Scene();

					// 相机
					mapCamera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
					mapCamera.position.set( - 50, 0, 50 );

					// 控制器
					controls = new OrbitControls( mapCamera, renderer.domElement );
					controls.minDistance = 10;
					controls.maxDistance = 500;

					// 创建主正方体
					const mapGeometry = new THREE.BoxGeometry( 10, 10, 10 );
					// const mapMaterial = new THREE.MeshBasicMaterial( {color: 0x00ff00} )
					const mapMaterial = new THREE.LineBasicMaterial( { color: 0x4080ff } )
					mapCube = new THREE.Mesh( mapGeometry, mapMaterial );
					mapCube.scale.set( 1, 1, 1 );
					scene.add( mapCube );

					// 添加格子辅助线
					let grid = new THREE.GridHelper( 400, 30, 0xcccccc, 0xcccccc );
        			scene.add( grid );

					mapRender()
					function mapRender () {
						requestAnimationFrame( mapRender );
						renderer.render( scene, mapCamera )
					}
				}


				function initEarth() {
					// 渲染器
					earthRenderer = new THREE.WebGLRenderer( { antialias: true } );
					earthRenderer.setPixelRatio( window.devicePixelRatio );
					earthRenderer.setSize(400, 400);
					// document.body.appendChild( earthRenderer.domElement );
					document.getElementById('earth').appendChild( earthRenderer.domElement );

					// 场景
					earthScene = new THREE.Scene()

					// 相机
					earthCamera = new THREE.PerspectiveCamera( 40, 1, 1, 1000 );
					// earthCamera.position.copy( mapCamera.position );
					// earthCamera.position.set( - 50, 0, 50 );

					// 控制器
					earthControls = new OrbitControls( earthCamera, earthRenderer.domElement );
					earthControls.minDistance = 10;
					earthControls.maxDistance = 500;


					// 创建地球正方体
					const earthGeomerty = new THREE.BoxGeometry( 10, 10, 10);
					const earthMaterial = new THREE.LineBasicMaterial( { color: 0x4080ff } );
					earthCube = new THREE.LineSegments( earthGeomerty, earthMaterial );


					function deg2rad(deg) {
						return deg * (Math.PI/180)
					}
					// TODO:改变偏的角度
					earthCube.rotation.y = deg2rad(30)
					earthScene.add( earthCube );

					// 添加格子辅助线
					let grid = new THREE.GridHelper( 400, 30, 0xcccccc, 0xcccccc );
					earthScene.add( grid );

					earthRender()
					function earthRender () {
						requestAnimationFrame( earthRender );
				
						const {x, y, z} = mapCamera.position
						console.log('当前相机位置')
						console.log(x, y, z)

						let result = main({x, y, z})

						let earthX, earthY, earthZ
					
						result.forEach(item => {
							if (item.x * x >= 0 && item.y * y >=0 && item.z * z >=0) {
								console.log('命中>>>', item)
								earthX = item.x 
								earthY = item.y 
								earthZ = item.z
							}
						})




						// earthX = x 
						// earthY = y 
						// earthZ = z
						// earthCamera.quaternion.copy( mapCamera.quaternion )
						earthCamera.position.set(earthX, earthY, earthZ);
						earthControls.update();
						earthRenderer.render(earthScene, earthCamera)
					}

				}


				// onWindowResize(); 


			}

			function onWindowResize() {

				mapCamera.aspect = window.innerWidth / window.innerHeight;
				mapCamera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

				insetWidth = window.innerHeight / 4; // square
				insetHeight = window.innerHeight / 4;

				earthCamera.aspect = insetWidth / insetHeight;
				earthCamera.updateProjectionMatrix();

			}
		</script>

	</body>

</html>
